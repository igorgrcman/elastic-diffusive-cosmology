% ==============================================================================
% Figure: Three-channel localization schematic
% Z_3 symmetry with three equivalent minima for generations
% ==============================================================================

\begin{tikzpicture}[scale=0.88, transform shape]

% === Panel (a): Top view - hexagonal lattice with Z_3 sectors ===
\begin{scope}[shift={(0,0)}]
  % Background circle (brane cross-section)
  \fill[gray!10] (0,0) circle (2.2);
  \draw[thick, gray!50] (0,0) circle (2.2);

  % Three Z_3 sectors
  \fill[blue!20, opacity=0.7] (0,0) -- (90:2.2) arc (90:210:2.2) -- cycle;
  \fill[green!20, opacity=0.7] (0,0) -- (210:2.2) arc (210:330:2.2) -- cycle;
  \fill[red!20, opacity=0.7] (0,0) -- (330:2.2) arc (330:450:2.2) -- cycle;

  % Sector boundaries
  \draw[thick, dashed, gray!60] (0,0) -- (90:2.2);
  \draw[thick, dashed, gray!60] (0,0) -- (210:2.2);
  \draw[thick, dashed, gray!60] (0,0) -- (330:2.2);

  % Hexagonal flux tube hints
  \foreach \a in {0,60,...,300} {
    \draw[gray!30, thin] (\a:0.8) -- (\a+60:0.8);
    \draw[gray!30, thin] (\a:1.5) -- (\a+60:1.5);
  }

  % Generation labels in sectors
  \node[font=\small\bfseries, blue!70!black] at (150:1.4) {$e$};
  \node[font=\small\bfseries, green!70!black] at (270:1.4) {$\mu$};
  \node[font=\small\bfseries, red!70!black] at (30:1.4) {$\tau$};

  % Angle labels
  \node[font=\scriptsize] at (150:2.5) {$\xi = 0$};
  \node[font=\scriptsize] at (270:2.5) {$\xi = \frac{2\pi}{3}$};
  \node[font=\scriptsize] at (30:2.5) {$\xi = \frac{4\pi}{3}$};

  % Panel label
  \node[font=\small\bfseries] at (0,-3.0) {(a) Top view: $\mathbb{Z}_3$ sectors};
\end{scope}

% === Panel (b): Effective potential V(xi) ===
\begin{scope}[shift={(6.5,0)}]
  % Axes
  \draw[-{Stealth}, thick] (-0.3,0) -- (5.5,0) node[right, font=\small] {$\xi$};
  \draw[-{Stealth}, thick] (0,-0.3) -- (0,2.8) node[above, font=\small] {$V(\xi)$};

  % Potential curve with three minima
  \draw[thick, blue!70!black, domain=0:5.2, samples=100]
    plot (\x, {1.8 + 0.8*cos(3*\x*180/3.14159/1.65)});

  % Well bottoms marked
  \fill[blue!60] (0.87,1.0) circle (3pt);
  \fill[green!60] (2.61,1.0) circle (3pt);
  \fill[red!60] (4.35,1.0) circle (3pt);

  % Wavefunctions (Gaussians)
  \draw[thick, blue!70, domain=0.2:1.5, samples=50]
    plot (\x, {0.3 + 0.6*exp(-4*(\x-0.87)*(\x-0.87))});
  \draw[thick, green!70, domain=1.9:3.3, samples=50]
    plot (\x, {0.3 + 0.6*exp(-4*(\x-2.61)*(\x-2.61))});
  \draw[thick, red!70, domain=3.7:5.0, samples=50]
    plot (\x, {0.3 + 0.6*exp(-4*(\x-4.35)*(\x-4.35))});

  % Labels
  \node[font=\scriptsize, blue!70!black] at (0.87,-0.35) {$f_e$};
  \node[font=\scriptsize, green!70!black] at (2.61,-0.35) {$f_\mu$};
  \node[font=\scriptsize, red!70!black] at (4.35,-0.35) {$f_\tau$};

  % Z_3 symmetry annotation
  \draw[<->, thick, gray] (0.87,2.5) -- (2.61,2.5) node[midway, above, font=\scriptsize] {$\frac{2\pi}{3}$};

  % Panel label
  \node[font=\small\bfseries] at (2.6,-1.2) {(b) $V(\xi)$: three equivalent minima};
\end{scope}

% === Panel (c): Cross-section showing brane thickness ===
\begin{scope}[shift={(3.2,-4.5)}]
  % Bulk region (above)
  \fill[gray!15] (-1.5,1.2) rectangle (4.5,2.5);
  \node[font=\scriptsize, gray!60!black] at (3.8,2.2) {5D Bulk};

  % Brane region (thick layer)
  \fill[blue!12] (-1.5,0) rectangle (4.5,1.2);
  \draw[thick, blue!40] (-1.5,1.2) -- (4.5,1.2);
  \draw[thick, blue!40] (-1.5,0) -- (4.5,0);

  % Observer boundary
  \fill[green!10] (-1.5,-0.8) rectangle (4.5,0);
  \node[font=\scriptsize, green!60!black] at (3.8,-0.5) {3D Observer};

  % Thickness annotation
  \draw[<->, thick] (-1.2,0) -- (-1.2,1.2);
  \node[font=\scriptsize, rotate=90] at (-1.5,0.6) {$\delta$};

  % Radial coordinate
  \draw[-{Stealth}, thick] (0,-0.5) -- (0,2.2) node[above, font=\small] {$r$};
  \node[font=\scriptsize] at (0.4,0.6) {$\xi$};

  % Fermion localization (near observer face)
  \fill[blue!50] (1.5,0.15) circle (4pt);
  \fill[green!50] (2.2,0.15) circle (4pt);
  \fill[red!50] (2.9,0.15) circle (4pt);
  \node[font=\scriptsize] at (2.2,-0.3) {$\xi \approx 0$};

  % Panel label
  \node[font=\small\bfseries] at (1.5,-1.3) {(c) Cross-section: fermions at $\xi \approx 0$};
\end{scope}

\end{tikzpicture}
