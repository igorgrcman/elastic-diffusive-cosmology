% ==============================================================================
% Figure: Overlap â†’ Mixing intuition
% Shows how wavefunction overlap determines mixing matrix elements
% ==============================================================================

\begin{tikzpicture}[scale=0.90, transform shape]

% === Panel (a): Large overlap (diagonal) ===
\begin{scope}[shift={(0,0)}]
  % Axes
  \draw[-{Stealth}, thick] (-0.3,0) -- (4.5,0) node[right, font=\small] {$\xi$};
  \draw[-{Stealth}, thick] (0,-0.3) -- (0,2.5) node[above, font=\small] {$|f|^2$};

  % Two overlapping Gaussians (same generation)
  \draw[thick, blue!70, domain=0:4, samples=80]
    plot (\x, {1.8*exp(-2*(\x-2)*(\x-2))});
  \draw[thick, blue!70, dashed, domain=0:4, samples=80]
    plot (\x, {1.6*exp(-2.2*(\x-2.1)*(\x-2.1))});

  % Shaded overlap region
  \fill[blue!30, opacity=0.5, domain=0.8:3.2, samples=50]
    plot (\x, {min(1.8*exp(-2*(\x-2)*(\x-2)), 1.6*exp(-2.2*(\x-2.1)*(\x-2.1)))})
    -- (3.2,0) -- (0.8,0) -- cycle;

  % Labels
  \node[font=\scriptsize, blue!70!black] at (2,2.1) {$f_i$};
  \node[font=\scriptsize, blue!50!black] at (2.5,1.5) {$f_j$};
  \node[font=\scriptsize] at (2,-0.4) {Large overlap};

  % Result
  \node[font=\small, draw, rounded corners, fill=green!10] at (2,-1.0)
    {$|U_{ij}|^2 \approx 1$};

  % Panel label
  \node[font=\small\bfseries] at (2,-1.8) {(a) Diagonal: $i = j$};
\end{scope}

% === Panel (b): Small overlap (off-diagonal) ===
\begin{scope}[shift={(6,0)}]
  % Axes
  \draw[-{Stealth}, thick] (-0.3,0) -- (5.5,0) node[right, font=\small] {$\xi$};
  \draw[-{Stealth}, thick] (0,-0.3) -- (0,2.5) node[above, font=\small] {$|f|^2$};

  % Two separated Gaussians
  \draw[thick, blue!70, domain=0:3, samples=60]
    plot (\x, {1.8*exp(-3*(\x-1.2)*(\x-1.2))});
  \draw[thick, red!70, domain=2:5.2, samples=60]
    plot (\x, {1.8*exp(-3*(\x-3.8)*(\x-3.8))});

  % Small overlap region (barely visible)
  \fill[purple!30, opacity=0.5, domain=2.2:2.8, samples=30]
    plot (\x, {min(1.8*exp(-3*(\x-1.2)*(\x-1.2)), 1.8*exp(-3*(\x-3.8)*(\x-3.8)))})
    -- (2.8,0) -- (2.2,0) -- cycle;

  % Labels
  \node[font=\scriptsize, blue!70!black] at (1.2,2.1) {$f_i$};
  \node[font=\scriptsize, red!70!black] at (3.8,2.1) {$f_j$};

  % Separation arrow
  \draw[<->, thick, gray] (1.2,1.5) -- (3.8,1.5);
  \node[font=\scriptsize, gray] at (2.5,1.75) {$\Delta\xi$};
  \node[font=\scriptsize] at (2.5,-0.4) {Small overlap};

  % Result
  \node[font=\small, draw, rounded corners, fill=red!10] at (2.5,-1.0)
    {$|U_{ij}|^2 \sim e^{-\Delta\xi^2}$};

  % Panel label
  \node[font=\small\bfseries] at (2.5,-1.8) {(b) Off-diagonal: $i \neq j$};
\end{scope}

% === Panel (c): Mixing matrix structure ===
\begin{scope}[shift={(3,-5)}]
  % Matrix brackets
  \draw[thick] (-0.1,1.8) -- (-0.3,1.8) -- (-0.3,-0.3) -- (-0.1,-0.3);
  \draw[thick] (3.6,1.8) -- (3.8,1.8) -- (3.8,-0.3) -- (3.6,-0.3);

  % Matrix elements with colors showing magnitude
  % Row 1
  \node[font=\small, fill=green!40, minimum size=0.7cm] at (0.5,1.3) {$\approx 1$};
  \node[font=\small, fill=yellow!30, minimum size=0.7cm] at (1.7,1.3) {$\lambda$};
  \node[font=\small, fill=red!20, minimum size=0.7cm] at (2.9,1.3) {$\lambda^3$};

  % Row 2
  \node[font=\small, fill=yellow!30, minimum size=0.7cm] at (0.5,0.5) {$\lambda$};
  \node[font=\small, fill=green!40, minimum size=0.7cm] at (1.7,0.5) {$\approx 1$};
  \node[font=\small, fill=orange!25, minimum size=0.7cm] at (2.9,0.5) {$\lambda^2$};

  % Row 3
  \node[font=\small, fill=red!20, minimum size=0.7cm] at (0.5,-0.1) {$\lambda^3$};
  \node[font=\small, fill=orange!25, minimum size=0.7cm] at (1.7,-0.1) {$\lambda^2$};
  \node[font=\small, fill=green!40, minimum size=0.7cm] at (2.9,-0.1) {$\approx 1$};

  % Labels
  \node[font=\small] at (-0.8,0.75) {$|U|^2 =$};

  % Legend
  \node[font=\scriptsize, fill=green!40, minimum width=0.5cm] at (5.2,1.3) {};
  \node[font=\scriptsize, anchor=west] at (5.5,1.3) {large overlap};
  \node[font=\scriptsize, fill=yellow!30, minimum width=0.5cm] at (5.2,0.7) {};
  \node[font=\scriptsize, anchor=west] at (5.5,0.7) {moderate};
  \node[font=\scriptsize, fill=red!20, minimum width=0.5cm] at (5.2,0.1) {};
  \node[font=\scriptsize, anchor=west] at (5.5,0.1) {suppressed};

  % Panel label
  \node[font=\small\bfseries] at (1.7,-1.0) {(c) Wolfenstein hierarchy from localization};
\end{scope}

\end{tikzpicture}
